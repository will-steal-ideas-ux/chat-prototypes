<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nexus.ai — V2 Audio Input</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap');

    :root {
      --bg-primary:    #f7f7f8;
      --bg-secondary:  #ffffff;
      --bg-tertiary:   rgba(124,123,132,.10);
      --border-secondary: rgba(124,123,132,.25);
      --text-primary:   #252429;
      --text-secondary: #464546;
      --text-tertiary:  #6f6e78;
      --text-placeholder: #6f6e78;
      --brand-purple:  #6c47ff;
      --brand-purple-light: #ede9ff;
      --radius-xs: 4px;
      --radius-sm: 8px;
      --radius-md: 16px;
      --radius-full: 9999px;
      --shadow-lg: 0 8px 15px rgba(18,0,69,.06), 0 4px 7px rgba(18,0,69,.03);
      --transition: .18s ease;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ─── Top nav ─────────────────────────────────────────── */
    .top-nav {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-secondary);
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px 0 0;
      flex-shrink: 0;
      z-index: 10;
    }
    .nav-left { display: flex; align-items: center; gap: 32px; }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 24px;
      width: 248px;
      text-decoration: none;
    }
    .logo-emblem {
      width: 32px; height: 32px;
      background: var(--text-primary);
      border-radius: 6px;
      display: flex; align-items: center; justify-content: center;
    }
    .logo-emblem svg { color: white; }
    .logo-name {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700; font-size: 17px;
      color: var(--text-primary); letter-spacing: -0.3px;
    }
    .logo-name span { color: var(--brand-purple); font-size: 11px; vertical-align: super; font-weight: 500; }
    .nav-menu { display: flex; align-items: center; }
    .nav-item {
      display: flex; align-items: center;
      height: 56px; padding: 0 12px;
      font-size: 14px; font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer; position: relative;
      text-decoration: none;
      transition: color var(--transition);
    }
    .nav-item:hover { color: var(--text-primary); }
    .nav-item.active { color: var(--text-primary); }
    .nav-item.active::after {
      content: ''; position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 2px; background: var(--text-primary);
      border-radius: 2px 2px 0 0;
    }
    .nav-right { display: flex; align-items: center; gap: 24px; }
    .nav-docs {
      display: flex; align-items: center; gap: 4px;
      font-size: 14px; font-weight: 500;
      color: var(--text-secondary); text-decoration: none; cursor: pointer;
    }
    .nav-docs:hover { color: var(--text-primary); }
    .nav-docs svg { width: 16px; height: 16px; }
    .avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: #e0d8ff; display: flex; align-items: center; justify-content: center;
      font-size: 14px; font-weight: 600; color: var(--brand-purple); cursor: pointer;
    }

    /* ─── Body layout ─────────────────────────────────────── */
    .body-layout { display: flex; flex: 1; overflow: hidden; }

    /* ─── Sidebar ─────────────────────────────────────────── */
    .sidebar {
      width: 248px; background: var(--bg-primary);
      display: flex; flex-direction: column;
      flex-shrink: 0; overflow: hidden;
      transition: width var(--transition);
      border-right: 1px solid var(--border-secondary);
    }
    .sidebar.collapsed { width: 0; }
    .sidebar-top {
      display: flex; align-items: center;
      justify-content: space-between;
      padding: 12px 8px 8px; flex-shrink: 0;
    }
    .icon-btn {
      width: 32px; height: 32px; border-radius: var(--radius-full);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; background: transparent; border: none;
      color: var(--text-tertiary);
      transition: background var(--transition), color var(--transition);
    }
    .icon-btn:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .icon-btn svg { width: 20px; height: 20px; }
    .sidebar-content { flex: 1; overflow-y: auto; padding: 0 8px 8px; }
    .sidebar-content::-webkit-scrollbar { width: 4px; }
    .sidebar-content::-webkit-scrollbar-thumb { background: var(--border-secondary); border-radius: 2px; }
    .sidebar-section { margin-bottom: 4px; }
    .sidebar-section-label {
      padding: 8px 8px; font-size: 12px; font-weight: 600;
      color: var(--text-tertiary);
    }
    .sidebar-link {
      display: flex; align-items: center;
      height: 40px; padding: 0 8px;
      font-size: 14px; font-weight: 500; color: var(--text-secondary);
      border-radius: var(--radius-sm); cursor: pointer;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
      transition: background var(--transition);
    }
    .sidebar-link:hover { background: var(--bg-tertiary); }
    .sidebar-link.active { background: var(--bg-tertiary); color: var(--text-primary); }

    /* ─── Main area ───────────────────────────────────────── */
    .main-area {
      flex: 1; display: flex; flex-direction: column;
      overflow: hidden; background: var(--bg-secondary);
    }

    /* ─── Welcome area ────────────────────────────────────── */
    .welcome-area {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 32px;
    }
    .welcome-heading {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600; font-size: 32px;
      color: var(--text-placeholder); letter-spacing: -0.25px; text-align: center;
    }

    /* ─── Prompt input ────────────────────────────────────── */
    .prompt-wrap { width: 100%; max-width: 760px; padding: 0 0 32px; }
    .prompt-box {
      position: relative;
      background: rgba(255,255,255,.85);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: 16px; display: flex; flex-direction: column; gap: 12px;
      backdrop-filter: blur(8px);
      transition: border-color var(--transition), box-shadow var(--transition);
    }
    .prompt-box:focus-within {
      border-color: rgba(124,123,132,.45);
      box-shadow: 0 8px 24px rgba(18,0,69,.09), 0 4px 10px rgba(18,0,69,.05);
    }
    .prompt-textarea {
      width: 100%; min-height: 28px; max-height: 200px;
      background: transparent; border: none; outline: none; resize: none;
      font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 400;
      color: var(--text-primary); line-height: 1.5; padding: 4px 4px 0;
    }
    .prompt-textarea::placeholder { color: var(--text-placeholder); }
    .prompt-actions {
      display: flex; align-items: center;
      height: 40px;
    }
    .prompt-left { display: flex; align-items: center; gap: 4px; }
    .prompt-right { display: flex; align-items: center; gap: 4px; margin-left: auto; }
    .action-btn {
      display: inline-flex; align-items: center; gap: 6px;
      height: 36px; padding: 0 10px;
      border-radius: var(--radius-sm); border: none; background: transparent;
      font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 500;
      color: var(--text-primary); cursor: pointer;
      transition: background var(--transition);
    }
    .action-btn:hover { background: var(--bg-primary); }
    .action-btn svg { width: 20px; height: 20px; flex-shrink: 0; }
    .model-selector {
      display: inline-flex; align-items: center; gap: 6px;
      height: 36px; padding: 0 8px;
      border-radius: var(--radius-sm); background: transparent; border: none;
      font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 500;
      color: var(--text-secondary); cursor: pointer;
      transition: background var(--transition);
    }
    .model-selector:hover { background: var(--bg-primary); }
    .model-selector .model-logo {
      width: 28px; height: 28px; border-radius: 50%;
      background: var(--bg-primary);
      display: flex; align-items: center; justify-content: center; font-size: 12px;
    }
    .model-selector svg { width: 14px; height: 14px; color: var(--text-tertiary); }
    .mic-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      background: transparent; border: none; cursor: pointer;
      color: var(--text-tertiary);
      transition: background var(--transition), color var(--transition);
    }
    .mic-btn:hover { background: var(--bg-primary); color: var(--text-primary); }
    .mic-btn svg { width: 20px; height: 20px; }
    .send-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      background: var(--text-primary); border: none; cursor: pointer; color: white;
      transition: background var(--transition), opacity var(--transition), transform var(--transition);
      opacity: 0; pointer-events: none; transform: scale(0.85);
    }
    .send-btn.visible { opacity: 1; pointer-events: auto; transform: scale(1); }
    .send-btn:hover { background: #1a1a2e; }
    .send-btn svg { width: 18px; height: 18px; }

    /* ─── AI Tools popover ────────────────────────────────── */
    .action-btn.active {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .aitools-popover {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 0;
      right: 0;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: 12px;
      box-shadow: 0 16px 40px rgba(18,0,69,.12), 0 4px 12px rgba(18,0,69,.07);
      overflow: hidden;
      z-index: 100;
      display: none;
    }
    .aitools-popover.open { display: block; }

    .aitools-search {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-bottom: 1px solid var(--border-secondary);
    }
    .aitools-search svg { width: 16px; height: 16px; color: var(--text-tertiary); flex-shrink: 0; }
    .aitools-search input {
      flex: 1;
      border: none;
      outline: none;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      color: var(--text-primary);
      background: transparent;
    }
    .aitools-search input::placeholder { color: var(--text-placeholder); }
    .aitools-kbd {
      display: inline-flex;
      align-items: center;
      gap: 2px;
      padding: 2px 6px;
      border-radius: 5px;
      border: 1px solid var(--border-secondary);
      background: var(--bg-primary);
      font-size: 11px;
      font-weight: 500;
      color: var(--text-tertiary);
      white-space: nowrap;
      flex-shrink: 0;
      letter-spacing: 0;
    }

    .aitools-columns {
      display: flex;
    }
    .aitools-col {
      flex: 1;
      padding: 12px 0;
    }
    .aitools-col + .aitools-col {
      border-left: 1px solid var(--border-secondary);
      overflow-y: auto;
      max-height: 220px;
    }
    .aitools-col + .aitools-col::-webkit-scrollbar { width: 4px; }
    .aitools-col + .aitools-col::-webkit-scrollbar-thumb { background: var(--border-secondary); border-radius: 2px; }
    .aitools-col-label {
      padding: 2px 14px 8px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .aitools-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      cursor: pointer;
      transition: background var(--transition);
    }
    .aitools-item:hover { background: var(--bg-primary); }
    .aitools-item.hidden { display: none; }

    .aitools-icon {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background: var(--bg-primary);
    }
    .aitools-icon svg { width: 16px; height: 16px; }
    .aitools-icon img { width: 18px; height: 18px; }

    .aitools-info { flex: 1; min-width: 0; }
    .aitools-name {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .aitools-desc {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: 1px;
    }

    /* Toggle switch */
    .toggle {
      position: relative;
      width: 32px;
      height: 18px;
      flex-shrink: 0;
    }
    .toggle input { opacity: 0; width: 0; height: 0; position: absolute; }
    .toggle-track {
      position: absolute;
      inset: 0;
      background: var(--border-secondary);
      border-radius: 9px;
      cursor: pointer;
      transition: background .2s;
    }
    .toggle-track::after {
      content: '';
      position: absolute;
      width: 12px; height: 12px;
      border-radius: 50%;
      background: white;
      top: 3px; left: 3px;
      transition: transform .2s;
      box-shadow: 0 1px 3px rgba(0,0,0,.2);
    }
    .toggle input:checked + .toggle-track { background: var(--brand-purple); }
    .toggle input:checked + .toggle-track::after { transform: translateX(14px); }

    .aitools-empty {
      padding: 20px 14px;
      font-size: 13px;
      color: var(--text-tertiary);
      text-align: center;
      display: none;
    }

    /* ─── V2: Scrolling waveform canvas ──────────────────── */
    #waveform-canvas {
      display: none;
      width: 100%;
      height: 24px;
    }
    #waveform-canvas.active { display: block; }

    /* Recording actions row (swaps in for normal actions) */
    .prompt-actions-recording {
      display: none;
      align-items: center;
      height: 40px;
    }
    .prompt-actions-recording.active { display: flex; }
    .prompt-actions-recording .prompt-right { margin-left: auto; display: flex; align-items: center; gap: 4px; }

    /* Stop button */
    .stop-btn {
      width: 36px; height: 36px; border-radius: var(--radius-sm);
      display: flex; align-items: center; justify-content: center;
      background: transparent; border: none; cursor: pointer;
      color: var(--text-tertiary);
      transition: background var(--transition), color var(--transition);
    }
    .stop-btn:hover { background: var(--bg-primary); color: var(--text-primary); }
    .stop-btn svg { width: 20px; height: 20px; }

    /* ─── Version switcher ────────────────────────────────── */
    .version-switcher {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 9999;
      font-family: 'Inter', sans-serif;
    }
    .version-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      height: 32px;
      padding: 0 10px 0 8px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: var(--radius-full);
      box-shadow: 0 2px 8px rgba(18,0,69,.08);
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: border-color var(--transition), box-shadow var(--transition), color var(--transition);
      user-select: none;
    }
    .version-badge:hover {
      border-color: rgba(124,123,132,.45);
      color: var(--text-primary);
      box-shadow: 0 4px 12px rgba(18,0,69,.12);
    }
    .version-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--brand-purple);
      flex-shrink: 0;
    }
    .version-chevron {
      width: 14px; height: 14px;
      color: var(--text-tertiary);
      transition: transform var(--transition);
    }
    .version-switcher.open .version-chevron { transform: rotate(180deg); }

    .version-menu {
      position: absolute;
      bottom: calc(100% + 6px);
      left: 0;
      min-width: 220px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-secondary);
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(18,0,69,.12), 0 2px 8px rgba(18,0,69,.06);
      overflow: hidden;
      display: none;
    }
    .version-switcher.open .version-menu { display: block; }

    .version-menu-header {
      padding: 10px 14px 6px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }
    .version-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      cursor: pointer;
      transition: background var(--transition);
      text-decoration: none;
    }
    .version-item:hover { background: var(--bg-primary); }
    .version-item.current { background: var(--brand-purple-light); }
    .version-item-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: var(--border-secondary);
      flex-shrink: 0;
    }
    .version-item.current .version-item-dot { background: var(--brand-purple); }
    .version-item-info { flex: 1; min-width: 0; }
    .version-item-label {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .version-item-desc {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 1px;
    }
    .version-item-tag {
      font-size: 10px;
      font-weight: 600;
      color: var(--brand-purple);
      background: var(--brand-purple-light);
      padding: 2px 6px;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <!-- Top Nav -->
  <nav class="top-nav">
    <div class="nav-left">
      <a class="logo" href="#">
        <div class="logo-emblem">
          <svg width="18" height="18" fill="none" viewBox="0 0 24 24"><path d="M12 2 2 7l10 5 10-5-10-5ZM2 17l10 5 10-5M2 12l10 5 10-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <span class="logo-name">nexos<span>.ai</span></span>
      </a>
      <nav class="nav-menu">
        <a class="nav-item active" href="#">Chat</a>
        <a class="nav-item" href="#">Compare models</a>
        <a class="nav-item" href="#">Projects</a>
        <a class="nav-item" href="#">Agents</a>
      </nav>
    </div>
    <div class="nav-right">
      <a class="nav-docs" href="#">
        Docs
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14 21 3"/></svg>
      </a>
      <div class="avatar">T</div>
    </div>
  </nav>

  <!-- Body -->
  <div class="body-layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-top">
        <button class="icon-btn" onclick="document.getElementById('sidebar').classList.toggle('collapsed')" title="Collapse sidebar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M9 3v18"/></svg>
        </button>
        <button class="icon-btn" title="New chat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/></svg>
        </button>
      </div>
      <div class="sidebar-content">
        <div class="sidebar-section">
          <div class="sidebar-section-label">Yesterday</div>
          <div class="sidebar-link active">Cybersecurity market tr...</div>
          <div class="sidebar-link">Generate an image bursting...</div>
        </div>
        <div class="sidebar-section">
          <div class="sidebar-section-label">Previous 30 days</div>
          <div class="sidebar-link">EV Market Trends Analysis</div>
          <div class="sidebar-link">Target Audience Brainstorming</div>
          <div class="sidebar-link">Summary of the user resear...</div>
          <div class="sidebar-link">Cybersecurity market trend...</div>
          <div class="sidebar-link">Data trends analysis</div>
          <div class="sidebar-link">EV Market Trends Analysis</div>
          <div class="sidebar-link">Target Audience Brainstorming</div>
          <div class="sidebar-link">Summary of the user resear...</div>
          <div class="sidebar-link">Cybersecurity market trend...</div>
          <div class="sidebar-link">Data trends analysis</div>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main-area">
      <!-- Welcome -->
      <div class="welcome-area">
        <h1 class="welcome-heading">What's on your mind today?</h1>
        <div class="prompt-wrap">
          <div class="prompt-box">
            <textarea class="prompt-textarea" id="prompt"
              placeholder="Ask anything to start the chat"
              rows="1"
              oninput="onInput(this)"></textarea>

            <!-- Scrolling waveform canvas (shown when recording) -->
            <canvas id="waveform-canvas"></canvas>

            <!-- AI Tools Popover (anchored to prompt-box) -->
            <div class="aitools-popover" id="aitools-popover">
              <div class="aitools-search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input type="text" id="aitools-search" placeholder="Search" oninput="filterAITools(this.value)" onkeydown="handleSearchKey(event)" autocomplete="off" />
                <span class="aitools-kbd">⌘K</span>
              </div>
              <div class="aitools-columns">
                <div class="aitools-col" id="col-capabilities">
                  <div class="aitools-col-label">AI Capabilities</div>
                  <div class="aitools-item" data-name="deep research">
                    <div class="aitools-icon" style="background:#ede9ff"><svg viewBox="0 0 24 24" fill="none" stroke="#6c47ff" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3M11 8v6M8 11h6"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Deep research</div><div class="aitools-desc">Perform advanced research</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="web search">
                    <div class="aitools-icon" style="background:#e0f2fe"><svg viewBox="0 0 24 24" fill="none" stroke="#0284c7" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Web search</div><div class="aitools-desc">Find online information</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="extended thinking">
                    <div class="aitools-icon" style="background:#fef9c3"><svg viewBox="0 0 24 24" fill="none" stroke="#ca8a04" stroke-width="2"><path d="M9 18h6M10 22h4M12 2a7 7 0 0 1 7 7c0 2.5-1.3 4.7-3.3 6L15 17H9l-.7-2C6.3 13.7 5 11.5 5 9a7 7 0 0 1 7-7Z"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Extended thinking</div><div class="aitools-desc">Find online information</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-empty" id="empty-capabilities">No results</div>
                </div>
                <div class="aitools-col" id="col-integrations">
                  <div class="aitools-col-label">Integrations</div>
                  <div class="aitools-item" data-name="microsoft sharepoint sharepoint">
                    <div class="aitools-icon" style="background:#f0f4ff"><svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><circle cx="7" cy="7" r="5.5" fill="#036C70"/><circle cx="11" cy="10" r="5" fill="#1A9BA1"/><circle cx="7.5" cy="13" r="3.5" fill="#37C6D0"/><rect x="5" y="5" width="8" height="10" rx="1" fill="white" opacity=".15"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Microsoft Sharepoint</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="slack">
                    <div class="aitools-icon" style="background:#f9f0ff"><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path d="M5.5 11.5a1.5 1.5 0 0 1-3 0V6a1.5 1.5 0 0 1 3 0v5.5Z" fill="#E01E5A"/><path d="M12 5.5a1.5 1.5 0 0 1 0-3h.5A1.5 1.5 0 0 1 14 4v1.5H12Z" fill="#E01E5A"/><path d="M12.5 5.5H7a1.5 1.5 0 0 1 0-3h5.5a1.5 1.5 0 0 1 0 3Z" fill="#36C5F0"/><path d="M14 12a1.5 1.5 0 0 1-3 0V6a1.5 1.5 0 0 1 3 0v6Z" fill="#2EB67D"/><path d="M6 12.5a1.5 1.5 0 0 1 0 3H5.5A1.5 1.5 0 0 1 4 14v-1.5H6Z" fill="#2EB67D"/><path d="M5.5 12.5H11a1.5 1.5 0 0 1 0 3H5.5a1.5 1.5 0 0 1 0-3Z" fill="#ECB22E"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Slack</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="microsoft teams teams">
                    <div class="aitools-icon" style="background:#f0f4ff"><svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path d="M10.5 7h4a1 1 0 0 1 1 1v3.5a2 2 0 0 1-2 2H12a2 2 0 0 1-2-2V8a1 1 0 0 1 .5-.866V7Z" fill="#5059C9"/><circle cx="13" cy="5" r="1.5" fill="#5059C9"/><circle cx="8" cy="4.5" r="2" fill="#7B83EB"/><path d="M4 8h8a1 1 0 0 1 1 1v4a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V9a1 1 0 0 1 1-1Z" fill="#7B83EB"/><path d="M8 8v8" stroke="white" stroke-width="1.2"/><path d="M5 11h6" stroke="white" stroke-width="1.2"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Microsoft Teams</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="google drive drive">
                    <div class="aitools-icon" style="background:#f0fdf4"><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path d="M1.5 13.5 4 9l3 5.5H1.5Z" fill="#0F9D58"/><path d="M6.5 14.5h5L9 9.5 6.5 14.5Z" fill="#00832D"/><path d="M9 9.5l2.5 5 3-5.5L11 3.5 9 9.5Z" fill="#FBBC04"/><path d="M7 3.5l2 6 2-6-2-3.5L7 3.5Z" fill="#4285F4"/><path d="M4 9l3 5.5h5L9 9.5 7 3.5 4 9Z" fill="#34A853"/><path d="M7 3.5l4 0 3.5 6-3-5.5-4 0L4 9l-2.5 4.5 2.5-4.5L7 3.5Z" fill="#EA4335"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Google Drive</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="notion">
                    <div class="aitools-icon" style="background:#f5f5f5"><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><rect width="18" height="18" rx="3" fill="white"/><path d="M4 3.5h6.5l4 4V14a.5.5 0 0 1-.5.5H4a.5.5 0 0 1-.5-.5V4a.5.5 0 0 1 .5-.5Z" fill="#1a1a1a"/><path d="M10.5 3.5V7.5H14.5" fill="none" stroke="white" stroke-width=".8"/><path d="M6 7.5h6M6 9.5h6M6 11.5h4" stroke="white" stroke-width=".8" stroke-linecap="round"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">Notion</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-item" data-name="github">
                    <div class="aitools-icon" style="background:#f6f8fa"><svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill-rule="evenodd" clip-rule="evenodd" d="M9 1.5a7.5 7.5 0 0 0-2.372 14.621c.375.068.513-.163.513-.362 0-.179-.007-.653-.01-1.28-2.086.454-2.527-.996-2.527-.996-.341-.867-.833-1.098-.833-1.098-.68-.465.052-.456.052-.456.752.053 1.148.772 1.148.772.668 1.145 1.753.814 2.18.623.068-.484.261-.814.475-1.001-1.665-.19-3.416-.833-3.416-3.707 0-.818.292-1.488.772-2.012-.077-.19-.334-.952.073-1.985 0 0 .63-.201 2.063.769A7.18 7.18 0 0 1 9 6.299c.638.003 1.28.086 1.88.253 1.43-.97 2.06-.769 2.06-.769.408 1.033.151 1.795.074 1.985.48.524.771 1.194.771 2.012 0 2.882-1.754 3.515-3.424 3.7.269.232.508.69.508 1.39 0 1.003-.009 1.813-.009 2.06 0 .2.135.434.517.36A7.501 7.501 0 0 0 9 1.5Z" fill="#1a1a1a"/></svg></div>
                    <div class="aitools-info"><div class="aitools-name">GitHub</div></div>
                    <label class="toggle"><input type="checkbox" /><span class="toggle-track"></span></label>
                  </div>
                  <div class="aitools-empty" id="empty-integrations">No results</div>
                </div>
              </div>
            </div>

            <!-- Normal actions -->
            <div class="prompt-actions" id="actions-normal">
              <div class="prompt-left">
                <button class="action-btn">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 5v14M5 12h14"/></svg>
                  Attach
                </button>
                <button class="action-btn" id="aitools-btn" onclick="toggleAITools(event)">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3 4.5 20.3 12 17l7.5 3.3ZM12 3v14"/></svg>
                  AI Tools
                </button>
              </div>
              <div class="prompt-right">
                <button class="model-selector">
                  <div class="model-logo">✦</div>
                  Auto
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <button class="mic-btn" id="mic-btn" onclick="startRecording()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 22h8"/></svg>
                </button>
                <button class="send-btn" id="send">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2 11 13M22 2 15 22 11 13 2 9l20-7Z"/></svg>
                </button>
              </div>
            </div>

            <!-- Recording actions (Stop + Send) -->
            <div class="prompt-actions-recording" id="actions-recording">
              <div class="prompt-right">
                <button class="stop-btn" onclick="stopRecording()" title="Stop recording">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="5" y="5" width="14" height="14" rx="2"/></svg>
                </button>
                <button class="send-btn visible" onclick="submitRecording()">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2 11 13M22 2 15 22 11 13 2 9l20-7Z"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    function onInput(ta) {
      ta.style.height = 'auto';
      ta.style.height = Math.min(ta.scrollHeight, 200) + 'px';
      document.getElementById('send').classList.toggle('visible', ta.value.trim().length > 0);
    }

    // ── Canvas waveform — fills from right, scrolls left ──
    let rafId   = null;
    let bars    = [];   // grows rightward; newest bar = last element (right edge)
    let maxBars = 0;

    const STEP  = 8;   // 2px bar + 6px gap, matching Figma SVG
    const BAR_W = 2;
    const COLOR = '#44434B';

    function randomHeight() {
      // Speech-like distribution: silence, mid, peaks — min 4, max 22
      const r = Math.random();
      if (r < 0.12) return 4;                         // silence
      if (r < 0.35) return 4  + Math.random() * 5;   // near-silence
      if (r < 0.70) return 9  + Math.random() * 8;   // normal speech
      if (r < 0.88) return 17 + Math.random() * 3;   // loud
      return 20 + Math.random() * 2;                  // peak
    }

    function initCanvas() {
      const canvas = document.getElementById('waveform-canvas');
      const dpr    = window.devicePixelRatio || 1;
      const rect   = canvas.getBoundingClientRect();
      canvas.width  = Math.round(rect.width  * dpr);
      canvas.height = Math.round(rect.height * dpr);
      const ctx = canvas.getContext('2d');
      ctx.scale(dpr, dpr);
      maxBars = Math.floor(rect.width / STEP) + 1;
      bars = [];  // start empty — fills from right
    }

    function drawWaveform() {
      const canvas = document.getElementById('waveform-canvas');
      const dpr    = window.devicePixelRatio || 1;
      const W      = canvas.width  / dpr;
      const H      = canvas.height / dpr;
      const ctx    = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = COLOR;
      ctx.lineWidth   = BAR_W;
      ctx.lineCap     = 'round';

      // bars[last] = rightmost bar; bars[0] = leftmost
      // right-anchor: last bar sits at W - STEP/2, grows leftward
      bars.forEach((h, i) => {
        const x = W - (bars.length - i) * STEP + STEP / 2;
        const cy = H / 2;
        ctx.beginPath();
        ctx.moveTo(x, cy - h / 2);
        ctx.lineTo(x, cy + h / 2);
        ctx.stroke();
      });
    }

    let frameTick = 0;
    function animateWaveform() {
      frameTick++;
      // Add a new bar every 3 frames (~20 bars/sec at 60fps) — feels natural
      if (frameTick % 3 === 0) {
        bars.push(randomHeight());
        if (bars.length > maxBars) bars.shift();  // scroll once full
      }
      drawWaveform();
      rafId = requestAnimationFrame(animateWaveform);
    }

    function startRecording() {
      const textarea = document.getElementById('prompt');
      const canvas   = document.getElementById('waveform-canvas');
      textarea.style.display = 'none';
      canvas.classList.add('active');
      document.getElementById('actions-normal').style.display = 'none';
      document.getElementById('actions-recording').classList.add('active');
      initCanvas();
      frameTick = 0;
      rafId = requestAnimationFrame(animateWaveform);
    }

    function stopRecording() {
      cancelAnimationFrame(rafId); rafId = null;
      const canvas = document.getElementById('waveform-canvas');
      canvas.classList.remove('active');
      document.getElementById('actions-normal').style.display = '';
      document.getElementById('actions-recording').classList.remove('active');
      const textarea = document.getElementById('prompt');
      textarea.style.display = '';
      textarea.value = 'Summarise the key findings from my last cybersecurity report';
      onInput(textarea);
      textarea.focus();
    }

    function submitRecording() {
      stopRecording();
      // Simulate sending — clear textarea and reset
      setTimeout(() => {
        const textarea = document.getElementById('prompt');
        textarea.value = '';
        onInput(textarea);
      }, 80);
    }

    function toggleAITools(e) {
      e.stopPropagation();
      const popover = document.getElementById('aitools-popover');
      const btn = document.getElementById('aitools-btn');
      const isOpen = popover.classList.toggle('open');
      btn.classList.toggle('active', isOpen);
      if (isOpen) {
        setTimeout(() => document.getElementById('aitools-search').focus(), 50);
      }
    }

    function filterAITools(query) {
      const q = query.trim().toLowerCase();

      const capItems = document.querySelectorAll('#col-capabilities .aitools-item');
      const intItems = document.querySelectorAll('#col-integrations .aitools-item');

      let capVisible = 0, intVisible = 0;

      capItems.forEach(item => {
        const match = !q || item.dataset.name.includes(q);
        item.classList.toggle('hidden', !match);
        if (match) capVisible++;
      });

      intItems.forEach(item => {
        const match = !q || item.dataset.name.includes(q);
        item.classList.toggle('hidden', !match);
        if (match) intVisible++;
      });

      document.getElementById('empty-capabilities').style.display = capVisible === 0 ? 'block' : 'none';
      document.getElementById('empty-integrations').style.display = intVisible === 0 ? 'block' : 'none';
    }

    function handleSearchKey(e) {
      if (e.key !== 'Enter') return;
      // Collect all visible items across both columns
      const allItems = [
        ...document.querySelectorAll('#col-capabilities .aitools-item:not(.hidden)'),
        ...document.querySelectorAll('#col-integrations .aitools-item:not(.hidden)')
      ];
      if (allItems.length === 1) {
        const checkbox = allItems[0].querySelector('input[type="checkbox"]');
        if (checkbox) checkbox.checked = !checkbox.checked;
      }
    }

    // CMD+K global shortcut
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
        e.preventDefault();
        const popover = document.getElementById('aitools-popover');
        const btn = document.getElementById('aitools-btn');
        const isOpen = !popover.classList.contains('open');
        popover.classList.toggle('open', isOpen);
        btn.classList.toggle('active', isOpen);
        if (isOpen) {
          setTimeout(() => document.getElementById('aitools-search').focus(), 50);
        }
      }
    });

    // Close popover when clicking outside
    document.addEventListener('click', (e) => {
      const popover = document.getElementById('aitools-popover');
      const btn = document.getElementById('aitools-btn');
      if (!popover.contains(e.target) && !btn.contains(e.target)) {
        popover.classList.remove('open');
        btn.classList.remove('active');
      }
    });

    // Version switcher
    function toggleVersionMenu(e) {
      e.stopPropagation();
      document.getElementById('version-switcher').classList.toggle('open');
    }
    document.addEventListener('click', (e) => {
      const vs = document.getElementById('version-switcher');
      if (vs && !vs.contains(e.target)) vs.classList.remove('open');
    });
  </script>

  <!-- Version Switcher -->
  <div class="version-switcher" id="version-switcher">
    <div class="version-menu">
      <div class="version-menu-header">Versions</div>
      <a class="version-item current" href="v2.html">
        <div class="version-item-dot"></div>
        <div class="version-item-info">
          <div class="version-item-label">V2</div>
          <div class="version-item-desc">Audio Input</div>
        </div>
        <span class="version-item-tag">current</span>
      </a>
      <a class="version-item" href="v1.html">
        <div class="version-item-dot"></div>
        <div class="version-item-info">
          <div class="version-item-label">V1</div>
          <div class="version-item-desc">AI Tools redesign</div>
        </div>
      </a>
    </div>
    <div class="version-badge" onclick="toggleVersionMenu(event)">
      <div class="version-dot"></div>
      V2 — Audio Input
      <svg class="version-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
    </div>
  </div>

</body>
</html>
